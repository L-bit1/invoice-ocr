# 发票管理系统 - 使用指南

## 📋 目录

1. [快速开始](#快速开始)
2. [OCR功能安装](#ocr功能安装)
3. [基本功能使用](#基本功能使用)
4. [常见问题](#常见问题)
5. [技术支持](#技术支持)

---

## 🚀 快速开始

### 系统要求

- **操作系统**：Windows 7/10/11、macOS 10.12+、Linux
- **Python版本**：Python 3.6 或更高版本
- **内存**：建议 2GB 以上（使用OCR功能建议 4GB 以上）

### 首次运行

1. **检查Python环境**
   ```bash
   python --version
   # 或
   python3 --version
   ```
   确保版本为 3.6 或更高

2. **运行程序**
   - **Windows**：双击 `run.bat` 文件
   - **Mac/Linux**：在终端运行 `./run.sh`
   - **或直接运行**：
     ```bash
     python invoice_manager.py
     ```

3. **程序启动**
   - 首次运行会自动创建数据库文件 `invoices.db`
   - 界面打开后即可开始使用

---

## 📷 OCR功能安装

OCR（光学字符识别）功能可以让您通过拍照或扫描发票，自动识别并填入发票信息，大大提高录入效率。

### ⚠️ 重要提示

- OCR功能是**可选的**，不安装OCR库也可以正常使用软件（手动录入）
- 如果不需要OCR功能，可以跳过此部分
- 建议使用**PaddleOCR**方案，对中文发票识别效果更好

---

### 方案1：PaddleOCR（推荐）⭐

**优点**：
- ✅ 中文识别准确率高
- ✅ 支持发票专用识别
- ✅ 无需额外安装软件
- ✅ 识别速度快

**安装步骤**：

#### Windows系统

**方法A：使用安装脚本（推荐）**
1. 双击运行 `install_ocr.bat`
2. 选择选项 `1`（PaddleOCR）
3. 等待安装完成

**方法B：手动安装**
1. 打开命令提示符（CMD）或PowerShell
2. 运行以下命令：
   ```bash
   pip install paddleocr paddlepaddle
   ```
3. 等待安装完成（首次安装可能需要几分钟，需要下载模型文件）

#### Mac系统

**方法A：使用安装脚本（推荐）**
1. 打开终端（Terminal）
2. 进入软件目录：
   ```bash
   cd "/Users/mac/Desktop/工作/软件/发票软件"
   ```
3. 运行安装脚本：
   ```bash
   ./install_ocr.sh
   ```
4. 选择选项 `1`（PaddleOCR）
5. 等待安装完成

**方法B：手动安装**
1. 打开终端（Terminal）
2. 运行以下命令：
   ```bash
   pip3 install paddleocr paddlepaddle
   ```
3. 等待安装完成

#### Linux系统

1. 打开终端
2. 运行以下命令：
   ```bash
   pip3 install paddleocr paddlepaddle
   ```
   或
   ```bash
   python3 -m pip install paddleocr paddlepaddle
   ```

#### 验证安装

安装完成后，运行程序，点击"新增发票"，如果看到"📷 OCR识别发票"按钮，说明安装成功！

**首次使用提示**：
- 首次使用OCR功能时，程序会自动下载识别模型（约100-200MB）
- 请确保网络连接正常
- 下载过程可能需要几分钟，请耐心等待

---

### 方案2：Tesseract OCR（备选方案）

**优点**：
- ✅ 开源免费
- ✅ 支持多种语言
- ✅ 资源占用较小

**缺点**：
- ⚠️ 需要额外安装Tesseract软件
- ⚠️ 中文识别准确率相对较低

**安装步骤**：

#### 第一步：安装Python库

**Windows/Mac/Linux通用**：
```bash
pip install pytesseract pillow
```
或
```bash
pip3 install pytesseract pillow
```

#### 第二步：安装Tesseract软件

**Windows系统**：
1. 访问下载页面：https://github.com/UB-Mannheim/tesseract/wiki
2. 下载最新版本的安装程序（推荐64位版本）
3. 运行安装程序，按提示安装
4. **重要**：安装时选择"中文简体"语言包
5. 记住安装路径（默认：`C:\Program Files\Tesseract-OCR`）

**Mac系统**：
```bash
brew install tesseract tesseract-lang
```

**Linux系统（Ubuntu/Debian）**：
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr tesseract-ocr-chi-sim
```

**Linux系统（CentOS/RHEL）**：
```bash
sudo yum install tesseract tesseract-langpack-chi_sim
```

#### 第三步：配置Python路径（仅Windows需要）

如果程序无法找到Tesseract，需要手动配置路径：

1. 找到 `invoice_manager.py` 文件
2. 在文件开头添加以下代码（如果使用pytesseract）：
   ```python
   import pytesseract
   # Windows系统需要指定Tesseract路径
   pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
   ```

---

## 📖 基本功能使用

### 1. 新增发票

#### 方式一：手动录入

1. 点击主界面上的 **"新增发票"** 按钮
2. 在弹出的对话框中填写发票信息：
   - **发票号码**（必填）：输入发票号码
   - **开票日期**（必填）：格式为 YYYY-MM-DD，默认为今天
   - **购买方名称**：购买方公司或个人名称
   - **购买方税号**：购买方的纳税人识别号或统一社会信用代码
   - **销售方名称**：销售方公司名称
   - **销售方税号**：销售方的纳税人识别号
   - **金额**（必填）：不含税金额
   - **税额**：增值税税额
   - **合计**（必填）：价税合计金额
   - **发票类型**：选择增值税发票、普通发票或电子发票
   - **状态**：选择正常、作废或红冲
   - **备注**：其他需要记录的信息
3. 点击 **"保存"** 按钮

#### 方式二：OCR识别（需安装OCR库）

1. 点击主界面上的 **"新增发票"** 按钮
2. 点击对话框中的 **"📷 OCR识别发票"** 按钮
3. 在弹出的文件选择窗口中选择发票图片：
   - 支持格式：JPG、JPEG、PNG、BMP、GIF
   - 建议使用清晰、正面拍摄的发票照片
   - 图片大小建议不超过10MB
4. 等待识别完成（首次使用可能需要下载模型）
5. 查看识别结果预览窗口：
   - 显示识别到的字段信息
   - 显示完整的OCR识别文本（前500字符）
6. 点击 **"应用识别结果"** 按钮，信息会自动填入表单
7. **重要**：请仔细检查识别结果，必要时手动修正
8. 确认无误后点击 **"保存"** 按钮

**OCR识别技巧**：
- 📸 拍照时保持发票平整，避免褶皱
- 💡 确保光线充足，避免阴影
- 📐 尽量正面拍摄，避免倾斜
- 🔍 确保发票文字清晰可见
- ✂️ 可以裁剪图片，只保留发票部分

---

### 2. 查询发票

1. 在主界面顶部的 **"搜索"** 框中输入关键词
2. 支持搜索以下内容：
   - 发票号码
   - 购买方名称
   - 销售方名称
   - 备注信息
3. 输入后列表会自动更新显示匹配结果
4. 清空搜索框可显示所有发票

---

### 3. 查看发票详情

1. 在发票列表中**双击**任意一条发票记录
2. 弹出详情窗口显示该发票的完整信息
3. 查看完毕后关闭窗口

---

### 4. 删除发票

1. 在发票列表中**单击**选择要删除的发票
2. 点击主界面上的 **"删除发票"** 按钮
3. 在弹出的确认对话框中点击 **"是"**
4. ⚠️ **注意**：删除操作不可恢复，请谨慎操作

---

### 5. 导出数据

1. 点击菜单栏 **"文件"** → **"导出数据"**
2. 选择保存位置和文件名
3. 数据将导出为JSON格式文件
4. 导出的文件可以用文本编辑器打开查看
5. 也可以用于数据备份或导入其他系统

**导出文件格式说明**：
- 文件格式：JSON（JavaScript Object Notation）
- 编码：UTF-8
- 包含所有发票的完整信息

---

### 6. 查看统计信息

主界面顶部显示实时统计信息：
- **发票总数**：当前数据库中的发票数量
- **总金额**：所有发票的合计金额总和
- **总税额**：所有发票的税额总和

统计信息会随着发票的增删自动更新。

---

## ❓ 常见问题

### Q1: 程序无法启动怎么办？

**可能原因及解决方法**：

1. **Python未安装或版本过低**
   - 检查Python版本：`python --version`
   - 需要Python 3.6或更高版本
   - 下载地址：https://www.python.org/downloads/

2. **缺少tkinter模块**
   - Windows/Mac通常自带tkinter
   - Linux系统需要安装：`sudo apt-get install python3-tk`

3. **文件路径包含中文或特殊字符**
   - 尝试将软件移动到纯英文路径

### Q2: OCR识别不准确怎么办？

**解决方法**：

1. **提高图片质量**
   - 使用扫描件而非拍照
   - 确保图片清晰、光线充足
   - 避免图片倾斜或变形

2. **手动修正**
   - OCR识别后务必检查所有字段
   - 识别错误的字段可以手动修改

3. **尝试不同OCR方案**
   - 如果使用Tesseract效果不好，可以尝试PaddleOCR
   - PaddleOCR对中文发票识别效果更好

### Q3: OCR功能按钮不显示？

**原因**：未安装OCR库

**解决方法**：
1. 按照本文档"OCR功能安装"部分安装OCR库
2. 安装完成后重启程序
3. 如果仍不显示，检查安装是否正确：
   ```bash
   python -c "from paddleocr import PaddleOCR; print('PaddleOCR安装成功')"
   ```

### Q4: 数据库文件在哪里？

- 数据库文件：`invoices.db`
- 位置：与程序文件同一目录
- **重要**：请定期备份此文件，避免数据丢失

### Q5: 如何备份数据？

**方法一：导出数据**
1. 使用"文件" → "导出数据"功能
2. 将JSON文件保存到安全位置

**方法二：复制数据库文件**
1. 找到 `invoices.db` 文件
2. 复制到其他位置（如U盘、云盘）

### Q6: 可以导入之前导出的数据吗？

当前版本暂不支持批量导入功能，但可以：
1. 打开导出的JSON文件
2. 手动将数据重新录入系统
3. 或联系开发者添加导入功能

### Q7: 程序运行很慢怎么办？

**可能原因**：

1. **数据库文件过大**
   - 如果发票数量很多（>10000条），查询可能较慢
   - 建议定期清理不需要的发票

2. **OCR模型加载**
   - 首次使用OCR功能需要加载模型，可能较慢
   - 后续使用会快很多

3. **系统资源不足**
   - 关闭其他占用内存的程序
   - OCR功能需要较多内存，建议4GB以上

### Q8: 支持哪些发票类型？

当前支持：
- ✅ 增值税发票
- ✅ 普通发票
- ✅ 电子发票

其他类型可以手动选择最接近的类型。

### Q9: 可以修改已保存的发票吗？

当前版本暂不支持编辑功能，可以：
1. 删除原发票
2. 重新添加修改后的发票
3. 或联系开发者添加编辑功能

### Q10: 如何卸载OCR功能？

如果不需要OCR功能：
1. 无需卸载，程序会自动检测OCR库是否存在
2. 未安装OCR库时，OCR按钮不会显示
3. 如果已安装但不想使用，可以忽略OCR按钮

---

## 🛠️ 技术支持

### 获取帮助

如果遇到问题，可以：

1. **查看日志**
   - 程序运行时的错误信息会显示在控制台
   - Windows用户运行 `run.bat` 可以看到错误信息

2. **检查环境**
   - Python版本是否正确
   - 是否安装了必要的库
   - 系统权限是否足够

3. **重新安装**
   - 如果问题无法解决，可以尝试重新安装依赖库

### 更新日志

**版本 1.0**（当前版本）
- ✅ 发票录入功能
- ✅ OCR识别功能
- ✅ 发票查询功能
- ✅ 数据导出功能
- ✅ 统计信息显示

### 反馈建议

如有问题或建议，欢迎反馈！

---

## 📝 附录

### 快捷键说明

- **双击**：查看发票详情
- **单击**：选择发票（用于删除操作）

### 数据格式说明

**日期格式**：YYYY-MM-DD（例如：2024-01-15）

**金额格式**：支持小数，例如：1234.56

**税号格式**：支持18位统一社会信用代码或15位纳税人识别号

### 系统限制

- 发票号码必须唯一
- 金额和合计必须大于0
- 单次OCR识别图片大小建议不超过10MB
- 数据库文件大小无限制，但建议定期备份

---

**祝您使用愉快！** 🎉
